rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Public blogs
    match /blogs/{blogId} {
      allow read: if true;
      allow write: if request.auth.token.role in ['admin', 'editor'];
    }

    // Renter reports and incidents
    match /reports/{reportId} {
      allow read: if request.auth != null;
      allow write: if request.auth.token.role in ['admin', 'superadmin'];
    }

    // Risk and forecast data
    match /riskProfiles/{renterId},
          /riskForecasts/{renterId} {
      allow read: if request.auth != null;
      allow write: if request.auth.token.role in ['admin','superadmin'];
    }

    // Partners and enterprise
    match /enterpriseClients/{id},
          /partnerCases/{id},
          /partnerPayouts/{id} {
      allow read, write: if request.auth.token.role in ['superadmin'];
    }

    // Compliance
    match /consents/{userId},
          /deletionRequests/{id},
          /auditLogs/{id} {
      allow read, write: if request.auth.token.role in ['admin','superadmin'];
    }

    // Notifications
    match /notifications/{id} {
      allow read: if request.auth.uid == resource.data.userId;
      allow write: if request.auth != null;
    }
  }
}